<!DOCTYPE html>
<html lang="PT-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigilia - Fonte do Amor</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-[#1c1c1c] min-h-screen">
    <header>
        <img src="src/img/Logo - Chagas de amor - Vigilia.png" class="w-auto h-24 mx-auto pt-4">
    </header>
    
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <img src="src/img/Vigilia Fonte do Amor - Arte final.png" class="mx-auto pt-6 mb-6 sm:mb-8">
        </div>

        <div class="text-center">
            <a id="botao-participar" class="inline-block text-[#1c1c1c] p-4 sm:p-5 bg-[#f1e8df] cursor-pointer rounded-full font-black text-sm sm:text-base transition-all duration-500 hover:bg-holographic hover:text-white hover:scale-110 relative overflow-hidden group mb-6 sm:mb-8">
                <span class="relative z-10">Quero participar!</span>
                <div class="absolute inset-0 bg-cover bg-center opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-full" style="background-image: url('src/img/Untitled-5.png')"></div>
            </a>
        </div>
        
        <!-- Formul√°rio de Inscri√ß√£o -->
        <div id="inscricao-section" class="max-w-sm sm:max-w-md mx-auto rounded-2xl p-4 sm:p-6 lg:p-8 shadow-2xl mb-6 sm:mb-8 relative overflow-hidden backdrop-blur-md bg-white/20 border border-white/30">
            <div class="absolute inset-0 bg-cover bg-center opacity-30 rounded-2xl" style="background-image: url('src/img/Untitled-6.png')"></div>
            <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent rounded-2xl"></div>
            
            <div class="relative z-10">
                <h2 class="text-xl sm:text-2xl font-bold text-white text-center mb-4 sm:mb-6 drop-shadow-lg">Inscreva-se Gratuitamente</h2>
            
                <form id="inscricaoForm" class="space-y-3 sm:space-y-4">
                    <div>
                        <label for="nomeCompleto" class="block text-xs sm:text-sm font-semibold text-white mb-1 sm:mb-2 drop-shadow">
                            Nome Completo *
                        </label>
                        <input 
                            type="text" 
                            id="nomeCompleto" 
                            name="nomeCompleto" 
                            required
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-white/30 bg-white/90 backdrop-blur-sm focus:ring-2 focus:ring-white focus:border-white focus:bg-white outline-none transition-all duration-300"
                            placeholder="Digite seu nome completo"
                        >
                    </div>

                    <div>
                        <label for="email" class="block text-xs sm:text-sm font-semibold text-white mb-1 sm:mb-2 drop-shadow">
                            E-mail *
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-white/30 bg-white/90 backdrop-blur-sm focus:ring-2 focus:ring-white focus:border-white focus:bg-white outline-none transition-all duration-300"
                            placeholder="seu@email.com"
                        >
                    </div>

                    <div>
                        <label for="whatsapp" class="block text-xs sm:text-sm font-semibold text-white mb-1 sm:mb-2 drop-shadow">
                            WhatsApp *
                        </label>
                        <input 
                            type="tel" 
                            id="whatsapp" 
                            name="whatsapp" 
                            required
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-white/30 bg-white/90 backdrop-blur-sm focus:ring-2 focus:ring-white focus:border-white focus:bg-white outline-none transition-all duration-300"
                            placeholder="(11) 99999-9999"
                        >
                    </div>

                    <div>
                        <label for="paroquia" class="block text-xs sm:text-sm font-semibold text-white mb-1 sm:mb-2 drop-shadow">
                            Par√≥quia ou grupo que pertence *
                        </label>
                        <input 
                            type="text" 
                            id="paroquia" 
                            name="paroquia"
                            required
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-white/30 bg-white/90 backdrop-blur-sm focus:ring-2 focus:ring-white focus:border-white focus:bg-white outline-none transition-all duration-300"
                            placeholder="Nome da par√≥quia ou grupo"
                        >
                    </div>

                    <button 
                        type="submit"
                        id="submitBtn"
                        class="w-full text-white p-3 sm:p-4 bg-[#1c1c1c]/80 backdrop-blur-sm cursor-pointer rounded-lg font-bold text-sm sm:text-base transition-all duration-300 hover:bg-[#1c1c1c]/90 hover:scale-105 transform activate:bg-green-500 active:scale-95 mt-4 sm:mt-6 border border-white/20"
                    >
                        <span id="btnText">Confirmar Inscri√ß√£o</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o de Sucesso -->
        <div id="success-section" class="max-w-sm sm:max-w-md mx-auto rounded-2xl p-4 sm:p-6 lg:p-8 shadow-2xl mb-6 sm:mb-8 relative overflow-hidden backdrop-blur-md bg-green-500/20 border border-green-400/30 hidden">
            <div class="absolute inset-0 bg-cover bg-center opacity-20 rounded-2xl" style="background-image: url('src/img/Untitled-6.png')"></div>
            <div class="absolute inset-0 bg-gradient-to-br from-green-400/20 to-transparent rounded-2xl"></div>
            
            <div class="relative z-10 text-center">
                <div class="text-green-300 text-4xl mb-4">‚úÖ</div>
                <h2 class="text-xl sm:text-2xl font-bold text-white mb-4 drop-shadow-lg">Inscri√ß√£o Confirmada!</h2>
                <p class="text-white/90 mb-6 text-sm sm:text-base">Voc√™ receber√° um email de confirma√ß√£o em breve com todas as informa√ß√µes.</p>
                
                <div id="qr-container" class="bg-white/90 backdrop-blur-sm rounded-xl p-4 mb-6">
                    <h3 class="text-[#1c1c1c] font-bold mb-3 text-sm sm:text-base">üéüÔ∏è Seu QR Code de Check-in</h3>
                    <img id="qr-image" class="w-32 h-32 sm:w-40 sm:h-40 mx-auto border-2 border-gray-300 rounded-lg mb-3" alt="QR Code">
                    <p class="text-[#1c1c1c] text-xs sm:text-sm mb-2">
                        <strong>ID:</strong> <span id="qr-id" class="font-mono bg-gray-100 px-2 py-1 rounded"></span>
                    </p>
                    <p class="text-gray-600 text-xs">Apresente este c√≥digo na entrada do evento</p>
                    
                    <div class="flex flex-col sm:flex-row gap-2 mt-4">
                        <button id="download-qr" class="flex-1 bg-[#1c1c1c] text-white px-3 py-2 rounded-lg text-xs sm:text-sm font-semibold hover:bg-[#2c2c2c] transition-colors">
                            üì± Baixar QR
                        </button>
                        <button id="share-qr" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-xs sm:text-sm font-semibold hover:bg-blue-700 transition-colors">
                            üì§ Compartilhar
                        </button>
                    </div>
                </div>

                <a id="whatsapp-btn" href="https://chat.whatsapp.com/Fo3FvTjrG67HfhrJGTgjM3" target="_blank" class="inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-sm sm:text-base transition-all duration-300 transform hover:scale-105">
                    üí¨ Entrar no Grupo WhatsApp
                </a>
                
                <button id="nova-inscricao" class="block w-full mt-4 text-white/80 hover:text-white text-sm underline">
                    Fazer nova inscri√ß√£o
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxAOlhyqth09_Tffvea3rX42Zaf13ZG4-jRNcCKY9jMm67vRtEyyrj0pe6R6roht_SS/exec';

        // Elementos DOM
        const formulario = document.getElementById('inscricaoForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const inscricaoSection = document.getElementById('inscricao-section');
        const successSection = document.getElementById('success-section');

        // Enviar dados para API
        async function enviarParaAPI(dados) {
            const params = new URLSearchParams({
                action: 'inscricao',
                nomeCompleto: dados.nomeCompleto,
                email: dados.email,
                celular: dados.celular,
                paroquia: dados.paroquia,
                timestamp: Date.now()
            });
            
            try {
                await fetch(`${API_URL}?${params.toString()}`, {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                return {
                    sucesso: true,
                    qrCode: gerarQRCodeLocal(dados)
                };
                
            } catch (erro) {
                return enviarViaPopup(dados);
            }
        }

        // M√©todo alternativo via popup
        function enviarViaPopup(dados) {
            return new Promise((resolve) => {
                const params = new URLSearchParams({
                    action: 'inscricao',
                    nomeCompleto: dados.nomeCompleto,
                    email: dados.email,
                    celular: dados.celular,
                    paroquia: dados.paroquia,
                    redirect: '1'
                });
                
                const popup = window.open(
                    `${API_URL}?${params.toString()}`, 
                    'confirmacao_inscricao', 
                    'width=500,height=400,scrollbars=yes,resizable=yes'
                );
                
                if (!popup) {
                    throw new Error('Popup bloqueado');
                }
                
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkClosed);
                        resolve({
                            sucesso: true,
                            qrCode: gerarQRCodeLocal(dados)
                        });
                    }
                }, 500);
                
                setTimeout(() => {
                    if (!popup.closed) {
                        popup.close();
                        clearInterval(checkClosed);
                        resolve({
                            sucesso: true,
                            qrCode: gerarQRCodeLocal(dados)
                        });
                    }
                }, 8000);
            });
        }

        // Gerar QR Code local
        function gerarQRCodeLocal(dados) {
            const idUnico = `VIG${Date.now()}_${dados.nomeCompleto.replace(/\s/g, '').substring(0, 5)}`;
            
            const dadosQR = {
                id: idUnico,
                nome: dados.nomeCompleto,
                email: dados.email,
                whatsapp: dados.celular,
                paroquia: dados.paroquia,
                evento: "Vigilia_Fonte_do_Amor",
                data: new Date().toISOString()
            };
            
            const textoQR = JSON.stringify(dadosQR);
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(textoQR)}&bgcolor=FFFFFF&color=000000&margin=10`;
            
            return {
                url: qrCodeUrl,
                id: idUnico,
                dados: textoQR
            };
        }

        // Controle de loading
        function mostrarLoading() {
            submitBtn.disabled = true;
            btnText.textContent = 'Enviando...';
            submitBtn.classList.add('opacity-75');
        }

        function esconderLoading() {
            submitBtn.disabled = false;
            btnText.textContent = 'Confirmar Inscri√ß√£o';
            submitBtn.classList.remove('opacity-75');
        }

        // Mostrar sucesso
        function mostrarSucesso(qrInfo) {
            inscricaoSection.classList.add('hidden');
            
            document.getElementById('qr-image').src = qrInfo.url;
            document.getElementById('qr-id').textContent = qrInfo.id;
            
            document.getElementById('download-qr').onclick = () => {
                const link = document.createElement('a');
                link.href = qrInfo.url;
                link.download = `QRCode_${qrInfo.id}.png`;
                link.click();
            };
            
            document.getElementById('share-qr').onclick = () => {
                if (navigator.share) {
                    navigator.share({
                        title: 'Meu QR Code - Vig√≠lia Fonte do Amor',
                        text: `Meu c√≥digo de check-in: ${qrInfo.id}`,
                        url: qrInfo.url
                    });
                } else {
                    navigator.clipboard.writeText(`Meu QR Code da Vig√≠lia: ${qrInfo.url}`);
                    alert('Link copiado!');
                }
            };
            
            successSection.classList.remove('hidden');
            successSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Event Listeners
        document.getElementById('botao-participar').addEventListener('click', function(e) {
            e.preventDefault();
            inscricaoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        // Formata√ß√£o WhatsApp
        document.getElementById('whatsapp').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                if (value.length < 14) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                }
            }
            e.target.value = value;
        });

        // Envio do formul√°rio
        formulario.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const dados = {
                nomeCompleto: document.getElementById('nomeCompleto').value.trim(),
                email: document.getElementById('email').value.trim(),
                celular: document.getElementById('whatsapp').value.trim(),
                paroquia: document.getElementById('paroquia').value.trim()
            };
            
            // Valida√ß√µes
            if (!dados.nomeCompleto || !dados.email || !dados.celular || !dados.paroquia) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(dados.email)) {
                alert('Email inv√°lido!');
                return;
            }
            
            if (dados.celular.length < 14) {
                alert('WhatsApp inv√°lido!');
                return;
            }
            
            mostrarLoading();
            
            try {
                const resultado = await enviarParaAPI(dados);
                
                if (resultado.sucesso) {
                    mostrarSucesso(resultado.qrCode);
                    formulario.reset();
                    
                    // Salvar hist√≥rico local
                    const inscricoes = JSON.parse(localStorage.getItem('inscricoes_vigilia') || '[]');
                    inscricoes.push({
                        ...dados,
                        timestamp: new Date().toISOString(),
                        qrId: resultado.qrCode.id
                    });
                    localStorage.setItem('inscricoes_vigilia', JSON.stringify(inscricoes));
                }
            } catch (erro) {
                const qrEmergencia = gerarQRCodeLocal(dados);
                mostrarSucesso(qrEmergencia);
                formulario.reset();
            } finally {
                esconderLoading();
            }
        });

        // Nova inscri√ß√£o
        document.getElementById('nova-inscricao').addEventListener('click', function() {
            inscricaoSection.classList.remove('hidden');
            successSection.classList.add('hidden');
            inscricaoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    </script>
</body>
</html>